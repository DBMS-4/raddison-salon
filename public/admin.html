<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Raddison Salon</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      :root {
        --pastel-pink: #ffd6e0;
        --pastel-lavender: #e6e6fa;
        --pastel-mint: #ffd6e0;
        --pastel-peach: #ffd6e0;
        --pastel-blue: #e6e6fa;
        --pastel-lilac: #d8bfd8;
        --dark-text: #5d5d5d;
        --accent: #ff6b8b;
        --light: #fff9fb;
        --gradient: linear-gradient(135deg, #ffd6e0, #e6e6fa);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      }

      body {
        background: var(--light);
        color: var(--dark-text);
        overflow-x: hidden;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .password-field {
        position: relative;
        display: flex;
        align-items: center;
      }

      .password-field input[type="password"],
      .password-field input[type="text"] {
        padding-right: 40px;
        width: 100%;
      }

      .toggle-password {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #666;
        padding: 5px;
        background: none;
        border: none;
        font-size: 16px;
      }

      .toggle-password:hover {
        color: var(--accent);
      }

      header {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        padding: 0.8rem 0;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      header.scrolled {
        padding: 0.6rem 0;
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
      }

      .logo {
        font-family: "Playfair Display", serif;
        font-size: 1.8rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent), var(--pastel-lilac));
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0.5rem 0;
      }

      .logo i {
        font-size: 1.5rem;
        background: linear-gradient(135deg, var(--accent), var(--pastel-lilac));
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .nav-links {
        display: flex;
        list-style: none;
        gap: 1.2rem;
        align-items: center;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--dark-text);
        font-weight: 500;
        font-size: 0.95rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        transition: all 0.3s ease;
        position: relative;
        white-space: nowrap;
      }

      .nav-links a::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 2px;
        background: var(--accent);
        transition: all 0.3s ease;
        transform: translateX(-50%);
      }

      .nav-links a:hover,
      .nav-links a.active {
        color: var(--accent);
        background: rgba(255, 107, 139, 0.08);
      }

      .nav-links a:hover::after,
      .nav-links a.active::after {
        width: 60%;
      }

      .auth-buttons {
        display: flex;
        gap: 0.8rem;
        align-items: center;
      }

      .btn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: var(--shadow);
        font-size: 0.9rem;
        white-space: nowrap;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent), #ff8fa3);
        color: white;
      }

      .btn-outline {
        background: transparent;
        border: 1.5px solid var(--pastel-lilac);
        color: var(--dark-text);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #ff8fa3, var(--accent));
      }

      .btn-outline:hover {
        background: var(--pastel-lilac);
        color: white;
        border-color: var(--pastel-lilac);
      }

      .mobile-menu-btn {
        display: none;
        flex-direction: column;
        gap: 4px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
        position: relative;
        z-index: 1001;
      }

      .mobile-menu-btn span {
        width: 25px;
        height: 3px;
        background: var(--dark-text);
        transition: all 0.3s ease;
        border-radius: 2px;
        display: block;
      }

      .mobile-menu-btn:hover span {
        background: var(--accent);
      }

      .mobile-menu-btn.active span:nth-child(1) {
        transform: rotate(45deg) translate(7px, 7px);
      }

      .mobile-menu-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .mobile-menu-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -7px);
      }

      .page-header {
        background: linear-gradient(
          135deg,
          var(--pastel-pink) 0%,
          var(--pastel-lavender) 100%
        );
        color: var(--dark-text);
        padding: 140px 0 80px;
        text-align: center;
        margin-top: 80px;
        position: relative;
        overflow: hidden;
      }

      .page-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000" opacity="0.03"><path fill="%23FF6B8B" d="M500,200c150,0,250,100,250,250S650,700,500,700S250,600,250,450S350,200,500,200z"/></svg>');
        background-size: 600px;
        animation: float 20s infinite linear;
      }

      .page-header h1 {
        font-family: "Playfair Display", serif;
        font-size: 3.5rem;
        margin-bottom: 1rem;
        position: relative;
        z-index: 2;
      }

      .page-header p {
        font-size: 1.3rem;
        max-width: 600px;
        margin: 0 auto;
        opacity: 0.9;
        position: relative;
        z-index: 2;
      }

      .admin-section {
        background: white;
        margin: 40px 5%;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .admin-container {
        max-width: 800px;
        margin: 0 auto;
      }

      .admin-login {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
      }

      .admin-login h2 {
        color: #333;
        margin-bottom: 20px;
      }

      .admin-login p {
        color: #666;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
        text-align: left;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: 500;
      }

      .form-group input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus {
        border-color: var(--pastel-lilac);
        outline: none;
      }

      .login-btn {
        background: var(--accent);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: background 0.3s ease;
        width: 100%;
      }

      .login-btn:hover {
        background: #ff8fa3;
      }

      .admin-dashboard {
        display: none;
        background: #f8f9fa;
        padding: 30px;
        border-radius: 10px;
      }

      .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e9ecef;
      }

      .dashboard-header h2 {
        color: #333;
        margin: 0;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 30px;
        place-items: stretch;
      }

      @media (max-width: 600px) {
        .dashboard-grid {
          grid-template-columns: 1fr;
        }
      }

      .dashboard-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        text-align: center;
        box-shadow: var(--shadow);
        cursor: pointer;
        transition: all 0.3s ease;
        border-left: 4px solid var(--accent);
        width: 100%;
      }

      .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .dashboard-card i {
        font-size: 2.5rem;
        color: var(--accent);
        margin-bottom: 15px;
      }

      .dashboard-card h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.2rem;
      }

      .dashboard-card p {
        color: #666;
        font-size: 0.9rem;
      }

      .logout-btn {
        background: #dc3545;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s ease;
      }

      .logout-btn:hover {
        background: #c82333;
      }

      .dashboard-content {
        display: none;
        background: white;
        padding: 30px;
        border-radius: 10px;
        margin-top: 20px;
        box-shadow: var(--shadow);
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f8f9fa;
      }

      .content-header h3 {
        color: #333;
        margin: 0;
      }

      .back-btn {
        background: #6c757d;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
      }

      .back-btn:hover {
        background: #5a6268;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      table th,
      table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #333;
      }

      .edit-btn {
        color: #ffc107;
      }
      .delete-btn {
        color: #dc3545;
      }
      .confirm-btn {
        color: #28a745;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        animation: slideIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-header {
        margin-top: 0;
        color: #dc3545;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .modal-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 25px;
      }

      .modal-btn {
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .modal-btn-cancel {
        border: 1px solid #ddd;
        background: white;
        color: #666;
      }

      .modal-btn-cancel:hover {
        background: #f8f9fa;
      }

      .modal-btn-danger {
        border: none;
        background: #dc3545;
        color: white;
      }

      .modal-btn-danger:hover {
        background: #c82333;
      }

      .truncated-text {
        cursor: help;
        display: inline-block;
        max-width: 100%;
      }

      .truncated-text:hover {
        position: relative;
      }

      .action-btn {
        background: none;
        border: none;
        cursor: pointer;
        margin-right: 8px;
        font-size: 1.1rem;
        padding: 6px 8px;
        border-radius: 4px;
        transition: all 0.3s ease;
      }

      .action-btn:hover {
        transform: scale(1.1);
        background: rgba(0, 0, 0, 0.1);
      }

      .action-btn:last-child {
        margin-right: 0;
      }

      .status-cell {
        min-width: 120px;
      }

      .status-display {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
        min-width: 80px;
      }

      .status-scheduled {
        background: #fff0f5;
        color: #b05a7d;
      }

      .status-completed {
        background: #f0c1e0;
        color: #791c53;
      }

      .status-cancelled {
        background: #ffebee;
        color: #c62828;
      }

      .status-actions {
        display: flex;
        gap: 4px;
      }

      .btn-mini {
        padding: 4px 6px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s ease;
      }

      .btn-complete {
        background: #e8f5e8;
        color: #2e7d32;
      }

      .btn-complete:hover {
        background: #c8e6c9;
        transform: scale(1.05);
      }

      .btn-cancel {
        background: #ffebee;
        color: #c62828;
      }

      .btn-cancel:hover {
        background: #ffcdd2;
        transform: scale(1.05);
      }

      .staff-display {
        font-size: 0.9rem;
        color: #333;
      }

      .expand-arrow {
        cursor: pointer;
        color: var(--accent);
        font-size: 1.2rem;
        transition: transform 0.3s ease;
        display: inline-block;
        margin-right: 8px;
      }

      .expand-arrow.expanded {
        transform: rotate(90deg);
      }

      .notes-row {
        display: none;
        background: #f8f9fa;
      }

      .notes-row.show {
        display: table-row;
      }

      .notes-content {
        padding: 15px 20px;
        border-left: 3px solid var(--accent);
        background: white;
        margin: 10px;
        border-radius: 8px;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .notes-label {
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 5px;
        font-size: 0.9rem;
      }

      .notes-text {
        color: #555;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .stats-overview {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        justify-content: space-between;
        align-items: stretch;
      }

      .stat-item {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: var(--shadow);
        flex: 1;
        min-width: 150px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: var(--accent);
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-size: 0.9rem;
      }

      footer {
        background: var(--dark-text);
        color: white;
        padding: 4rem 0 1.5rem;
      }

      .footer-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 3rem;
        margin-bottom: 3rem;
      }

      .footer-section h3 {
        margin-bottom: 1.5rem;
        color: var(--pastel-pink);
        font-size: 1.3rem;
      }

      .footer-section p {
        margin-bottom: 1rem;
        opacity: 0.8;
        line-height: 1.6;
      }

      .footer-links {
        list-style: none;
      }

      .footer-links li {
        margin-bottom: 0.8rem;
      }

      .footer-links a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .footer-links a:hover {
        color: var(--pastel-pink);
        transform: translateX(5px);
      }

      .social-links {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .social-links a {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        color: white;
        transition: all 0.3s ease;
      }

      .social-links a:hover {
        background: var(--accent);
        transform: translateY(-3px);
      }

      .footer-bottom {
        text-align: center;
        padding-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        opacity: 0.7;
      }

      @media (max-width: 768px) {
        .mobile-menu-btn {
          display: flex;
        }

        .logo {
          font-size: 1.6rem;
        }

        .nav-links {
          position: fixed;
          top: 80px;
          left: 0;
          width: 100%;
          background: white;
          flex-direction: column;
          padding: 2rem;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
          transform: translateY(-100%);
          opacity: 0;
          transition: all 0.3s ease;
          z-index: 999;
        }

        .nav-links.active {
          transform: translateY(0);
          opacity: 1;
        }

        .nav-links a {
          padding: 1rem;
          text-align: center;
          border-radius: 10px;
          margin-bottom: 0.5rem;
        }

        .auth-buttons {
          flex-direction: column;
          width: 100%;
          gap: 0.5rem;
        }

        .auth-buttons .btn {
          width: 100%;
          justify-content: center;
        }

        .page-header {
          padding: 120px 0 60px;
        }

        .page-header h1 {
          font-size: 2.5rem;
        }

        .page-header p {
          font-size: 1.1rem;
          padding: 0 10px;
        }

        .admin-login {
          padding: 2rem;
          margin: 0 10px;
        }

        .admin-login h2 {
          font-size: 2rem;
        }

        .dashboard-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .dashboard-card {
          padding: 1.5rem;
        }

        .dashboard-card h3 {
          font-size: 1.1rem;
        }

        .stats-overview {
          flex-direction: column;
          gap: 10px;
        }

        .stat-item {
          min-width: auto;
          padding: 15px;
        }

        .stat-number {
          font-size: 2rem;
        }

        .status-actions {
          flex-direction: row;
          gap: 2px;
        }

        .btn-mini {
          padding: 3px 5px;
          font-size: 0.7rem;
        }

        .status-badge {
          font-size: 0.7rem;
          padding: 3px 6px;
          min-width: 70px;
        }

        .action-btn {
          margin-right: 4px;
          padding: 4px 6px;
          font-size: 0.9rem;
        }

        table {
          font-size: 0.85rem;
          display: block;
          overflow-x: auto;
          white-space: nowrap;
          -webkit-overflow-scrolling: touch;
        }

        table th,
        table td {
          padding: 8px 6px;
          min-width: 80px;
        }

        table th:first-child,
        table td:first-child {
          position: sticky;
          left: 0;
          background: white;
          z-index: 1;
        }

        .dashboard-content {
          padding: 1rem;
        }

        .content-header {
          flex-direction: column;
          gap: 1rem;
          align-items: flex-start;
        }

        .content-header h3 {
          font-size: 1.5rem;
        }

        .back-btn {
          align-self: flex-start;
        }

        .modal-content {
          width: 95%;
          max-width: none;
          margin: 10px;
          padding: 1.5rem;
        }

        .modal-header h3 {
          font-size: 1.3rem;
        }

        .modal-buttons {
          flex-direction: column;
          gap: 0.5rem;
        }

        .modal-btn {
          width: 100%;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="time"],
        input[type="number"],
        input[type="password"],
        select,
        textarea {
          font-size: 16px !important;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          padding: 0.8rem;
          font-size: 0.95rem;
        }

        .footer-content {
          grid-template-columns: 1fr;
          gap: 2rem;
        }

        .notes-content {
          padding: 0.8rem;
        }

        .notes-text {
          font-size: 0.85rem;
        }
      }

      @media (max-width: 480px) {
        .logo {
          font-size: 1.4rem;
        }

        .page-header {
          padding: 100px 0 50px;
        }

        .page-header h1 {
          font-size: 2rem;
        }

        .page-header p {
          font-size: 1rem;
        }

        .admin-login {
          padding: 1.5rem;
        }

        .admin-login h2 {
          font-size: 1.7rem;
        }

        .stats-overview {
          flex-direction: column;
          gap: 8px;
        }

        .stat-item {
          min-width: auto;
          padding: 12px;
        }

        .stat-number {
          font-size: 1.8rem;
        }

        .stat-label {
          font-size: 0.8rem;
        }

        .dashboard-card {
          padding: 1.2rem;
        }

        .dashboard-card i {
          font-size: 2rem;
        }

        .dashboard-card h3 {
          font-size: 1rem;
        }

        table {
          font-size: 0.75rem;
        }

        table th,
        table td {
          padding: 6px 4px;
          min-width: 70px;
        }

        .action-btn {
          padding: 3px 5px;
          font-size: 0.8rem;
        }

        .btn {
          padding: 0.5rem 1rem;
          font-size: 0.85rem;
        }

        .btn-mini {
          padding: 2px 4px;
          font-size: 0.65rem;
        }

        .content-header h3 {
          font-size: 1.3rem;
        }

        .modal-content {
          padding: 1rem;
        }

        .modal-header h3 {
          font-size: 1.1rem;
        }
      }
    </style>
  </head>
  <body>
    <header id="header">
      <div class="container">
        <nav class="navbar">
          <div class="logo">
            <i class="fas fa-spa"></i>
            Raddison Salon
          </div>

          <button class="mobile-menu-btn" id="mobileMenuBtn">
            <span></span>
            <span></span>
            <span></span>
          </button>

          <ul class="nav-links" id="navLinks">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li><a href="services.html" class="nav-link">Services</a></li>
            <li>
              <a href="appointment.html" class="nav-link">Book Appointment</a>
            </li>
            <li><a href="about.html" class="nav-link">About Us</a></li>
            <li><a href="contact.html" class="nav-link">Contact</a></li>
            <li><a href="admin.html" class="nav-link active">Admin</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <section class="page-header">
      <div class="container">
        <h1>Admin Dashboard</h1>
        <p>Manage salon operations and appointments</p>
      </div>
    </section>

    <section class="admin-section">
      <div class="admin-container">
        <div class="admin-login" id="adminLogin">
          <h2>Admin Login</h2>
          <p>
            Access the admin dashboard to manage appointments and salon
            operations
          </p>

          <form id="adminLoginForm">
            <div class="form-group">
              <label for="adminUsername">Username:</label>
              <input
                type="text"
                id="adminUsername"
                name="username"
                placeholder="Enter admin username"
                required
              />
            </div>
            <div class="form-group">
              <label for="adminPassword">Password:</label>
              <div class="password-field">
                <input
                  type="password"
                  id="adminPassword"
                  name="password"
                  placeholder="Enter admin password"
                  required
                />
                <button
                  type="button"
                  class="toggle-password"
                  onclick="togglePassword('adminPassword')"
                >
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <button type="submit" class="login-btn">
              Login to Admin Dashboard
            </button>
          </form>
        </div>

        <div class="admin-dashboard" id="adminDashboard">
          <div class="dashboard-header">
            <h2>Admin Dashboard</h2>
            <button class="logout-btn" onclick="logoutAdmin()">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>

          <div class="stats-overview">
            <div class="stat-item">
              <div class="stat-number" id="totalAppointments">0</div>
              <div class="stat-label">Total Appointments</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="pendingAppointments">0</div>
              <div class="stat-label">Pending</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="confirmedAppointments">0</div>
              <div class="stat-label">Confirmed</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="totalContacts">0</div>
              <div class="stat-label">Messages</div>
            </div>
          </div>

          <div class="dashboard-grid">
            <div class="dashboard-card" onclick="showAppointments()">
              <i class="fas fa-calendar-alt"></i>
              <h3>Appointments</h3>
              <p>Manage all bookings and schedules</p>
            </div>
            <div class="dashboard-card" onclick="showMessages()">
              <i class="fas fa-envelope"></i>
              <h3>Messages</h3>
              <p>View customer inquiries</p>
            </div>
            <div class="dashboard-card" onclick="showServices()">
              <i class="fas fa-spa"></i>
              <h3>Services</h3>
              <p>Manage regular service offerings</p>
            </div>
            <div class="dashboard-card" onclick="showPremium()">
              <i class="fas fa-crown"></i>
              <h3>Premium Services</h3>
              <p>Manage premium service offerings</p>
            </div>
            <div class="dashboard-card" onclick="showReportsTab()">
              <i class="fas fa-chart-bar"></i>
              <h3>Reports</h3>
              <p>Salon summary statistics</p>
            </div>
            <div class="dashboard-card" onclick="showStaff()">
              <i class="fas fa-users"></i>
              <h3>Staff Management</h3>
              <p>View and manage staff members</p>
            </div>
            <div class="dashboard-card" onclick="showAdminsTab()">
              <i class="fas fa-user-shield"></i>
              <h3>Admins</h3>
              <p>Add admins and view analytics</p>
            </div>
            <div class="dashboard-card" onclick="showCustomersTab()">
              <i class="fas fa-users"></i>
              <h3>Customers</h3>
              <p>View and edit customer information</p>
            </div>
          </div>

          <div class="dashboard-content" id="appointmentsContent">
            <div class="content-header">
              <h3>Appointment Management</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="appointmentsList"></div>
          </div>

          <div class="dashboard-content" id="messagesContent">
            <div class="content-header">
              <h3>Customer Messages</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="messagesList"></div>
          </div>

          <div class="dashboard-content" id="servicesContent">
            <div class="content-header">
              <h3>Service Management</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="servicesList"></div>
          </div>

          <div class="dashboard-content" id="premiumContent">
            <div class="content-header">
              <h3>Premium Service Management</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="premiumList"></div>
          </div>

          <div class="dashboard-content" id="staffContent">
            <div class="content-header">
              <h3>Staff Management</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="staffList"></div>
          </div>

          <div class="dashboard-content" id="reportsTabContent">
            <div class="content-header">
              <h3>Salon Reports</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="reportsTable">Loading...</div>
          </div>

          <div class="dashboard-content" id="adminsTabContent">
            <div class="content-header">
              <h3>Admin Management</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="adminsList"></div>
          </div>

          <div class="dashboard-content" id="customersTabContent">
            <div class="content-header">
              <h3>Customers</h3>
              <button class="back-btn" onclick="hideAllContent()">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
              </button>
            </div>
            <div id="customersList"></div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>Raddison Salon</h3>
            <p>
              Your destination for premium beauty and wellness services.
              Experience luxury like never before.
            </p>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-pinterest"></i></a>
            </div>
          </div>
          <div class="footer-section">
            <h3>Quick Links</h3>
            <ul class="footer-links">
              <li>
                <a href="index.html"
                  ><i class="fas fa-chevron-right"></i> Home</a
                >
              </li>
              <li>
                <a href="services.html"
                  ><i class="fas fa-chevron-right"></i> Services</a
                >
              </li>
              <li>
                <a href="appointment.html"
                  ><i class="fas fa-chevron-right"></i> Book Appointment</a
                >
              </li>
              <li>
                <a href="about.html"
                  ><i class="fas fa-chevron-right"></i> About Us</a
                >
              </li>
              <li>
                <a href="contact.html"
                  ><i class="fas fa-chevron-right"></i> Contact</a
                >
              </li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Contact Info</h3>
            <p><i class="fas fa-map-marker-alt"></i> 123 Beauty Street, City</p>
            <p><i class="fas fa-phone"></i> +1 234 567 8900</p>
            <p><i class="fas fa-envelope"></i> info@raddisonsalon.com</p>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 Raddison Salon. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const icon = event.currentTarget.querySelector("i");

        if (input.type === "password") {
          input.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          input.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      }

      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const navLinks = document.getElementById("navLinks");

      if (mobileMenuBtn && navLinks) {
        mobileMenuBtn.addEventListener("click", function (e) {
          e.preventDefault();
          navLinks.classList.toggle("active");
          mobileMenuBtn.classList.toggle("active");
        });
      }

      window.addEventListener("scroll", function () {
        const header = document.getElementById("header");
        if (window.scrollY > 50) {
          header.classList.add("scrolled");
        } else {
          header.classList.remove("scrolled");
        }
      });

      document
        .getElementById("adminLoginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const username = document.getElementById("adminUsername").value;
          const password = document.getElementById("adminPassword").value;

          try {
            const resp = await fetch("/api/admin/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });
            const data = await resp.json();

            if (!resp.ok) throw new Error(data.error || "Login failed");

            document.getElementById("adminLogin").style.display = "none";
            document.getElementById("adminDashboard").style.display = "block";
            updateDashboardStats();
          } catch (err) {
            alert("Login failed: " + err.message);
          }
        });

      async function updateDashboardStats() {
        try {
          const resp = await fetch("/api/admin/stats");
          if (resp.ok) {
            const stats = await resp.json();
            document.getElementById("totalAppointments").textContent =
              stats.total || 0;
            document.getElementById("pendingAppointments").textContent =
              stats.scheduled || 0;
            document.getElementById("confirmedAppointments").textContent =
              stats.completed || 0;
            document.getElementById("totalContacts").textContent =
              stats.messages || 0;
          }
        } catch (err) {
          console.error("Error updating stats:", err);
        }
      }

      function logoutAdmin() {
        document.getElementById("adminLogin").style.display = "block";
        document.getElementById("adminDashboard").style.display = "none";
        hideAllContent();
        document.getElementById("adminLoginForm").reset();
      }

      function hideAllContent() {
        document.querySelectorAll(".dashboard-content").forEach((content) => {
          content.style.display = "none";
        });

        const dashboardGrid = document.querySelector(".dashboard-grid");
        const statsOverview = document.querySelector(".stats-overview");
        if (dashboardGrid) dashboardGrid.style.display = "grid";
        if (statsOverview) statsOverview.style.display = "flex";

        scrollToAdminDashboard();
      }

      function hideDashboardTabs() {
        const dashboardGrid = document.querySelector(".dashboard-grid");
        const statsOverview = document.querySelector(".stats-overview");
        if (dashboardGrid) dashboardGrid.style.display = "none";
        if (statsOverview) statsOverview.style.display = "none";
      }

      function scrollToAdminDashboard() {
        const adminSection = document.querySelector(".admin-section");
        if (adminSection) {
          adminSection.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function showAppointments() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("appointmentsContent").style.display = "block";
        loadAppointments();
      }

      async function loadAppointments() {
        const container = document.getElementById("appointmentsList");
        container.innerHTML = "<p>Loading...</p>";

        try {
          const [apptResp, staffResp] = await Promise.all([
            fetch("/api/appointments"),
            fetch("/api/staff"),
          ]);

          const appointments = await apptResp.json();
          const staffList = await staffResp.json();
          const statusOptions = ["Scheduled", "Completed", "Cancelled"];

          let html =
            "<table><thead><tr><th>Customer</th><th>Service</th><th>Staff</th><th>Date</th><th>Time</th><th>Status</th><th>Actions</th></tr></thead><tbody>";

          appointments.forEach((a) => {
            const d = new Date(a.appointment_date);
            const dateStr = `${d.getDate().toString().padStart(2, "0")}/${(
              d.getMonth() + 1
            )
              .toString()
              .padStart(2, "0")}/${d.getFullYear()}`;

            const [h, m] = a.appointment_time.split(":");
            let hour = parseInt(h, 10);
            let ampm = hour >= 12 ? "PM" : "AM";
            hour = hour % 12 || 12;
            const timeStr = `${hour.toString().padStart(2, "0")}:${m} ${ampm}`;

            let statusContent = "";
            if (a.status === "Scheduled") {
              statusContent = `
                            <div class="status-display">
                                <span class="status-badge status-scheduled">${
                                  a.status
                                }</span>
                                <div class="status-actions">
                                    <button class="btn-mini btn-complete" onclick="updateAppointmentStatus(${
                                      a.appointment_id
                                    }, 'Completed')" title="Mark as Completed">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn-mini btn-cancel" onclick="updateAppointmentStatus(${
                                      a.appointment_id
                                    }, 'Cancelled')" title="Mark as Cancelled">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <select data-id="${
                              a.appointment_id
                            }" data-field="status" style="display:none;">
                                ${statusOptions
                                  .map(
                                    (opt) =>
                                      `<option value="${opt}"${
                                        a.status === opt ? " selected" : ""
                                      }>${opt}</option>`
                                  )
                                  .join("")}
                            </select>
                        `;
            } else {
              statusContent = `
                            <div class="status-display">
                                <span class="status-badge ${
                                  a.status === "Completed"
                                    ? "status-completed"
                                    : "status-cancelled"
                                }">${a.status}</span>
                            </div>
                            <select data-id="${
                              a.appointment_id
                            }" data-field="status" style="display:none;">
                                ${statusOptions
                                  .map(
                                    (opt) =>
                                      `<option value="${opt}"${
                                        a.status === opt ? " selected" : ""
                                      }>${opt}</option>`
                                  )
                                  .join("")}
                            </select>
                        `;
            }

            const hasNotes = a.notes && a.notes.trim();
            const expandArrow = hasNotes
              ? `<i class="fas fa-chevron-right expand-arrow" onclick="toggleNotes(${a.appointment_id})" id="arrow-${a.appointment_id}"></i>`
              : "";

            html += `<tr id="appt-row-${a.appointment_id}">
                        <td>${expandArrow}${
              a.customer_name || ""
            }<br><small style="color:#666;">${
              a.customer_phone || ""
            }</small></td>
                        <td>${a.service_name}</td>
                        <td>
                            <span class="staff-display">${
                              a.staff_name || "Not Assigned"
                            }</span>
                            <select data-id="${
                              a.appointment_id
                            }" data-field="staff_id" style="display:none;">
                                <option value="">Not Assigned</option>
                                ${staffList
                                  .map(
                                    (s) =>
                                      `<option value="${s.staff_id}"${
                                        a.staff_name === s.full_name
                                          ? " selected"
                                          : ""
                                      }>${s.full_name}</option>`
                                  )
                                  .join("")}
                            </select>
                        </td>
                        <td>${dateStr}</td>
                        <td>${timeStr}</td>
                        <td class="status-cell">
                            ${statusContent}
                        </td>
                        <td style="white-space:nowrap;">
                            <button class="action-btn edit-btn" onclick="toggleEditAppointment(${
                              a.appointment_id
                            })" id="edit-appt-${
              a.appointment_id
            }" data-editing="false" title="Edit">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteAppointment(${
                              a.appointment_id
                            })" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;

            if (hasNotes) {
              html += `<tr class="notes-row" id="notes-row-${a.appointment_id}">
                            <td colspan="7">
                                <div class="notes-content">
                                    <div class="notes-label"><i class="fas fa-sticky-note"></i> Customer Notes:</div>
                                    <div class="notes-text">${a.notes}</div>
                                </div>
                            </td>
                        </tr>`;
            }
          });

          html +=
            '<tr><td colspan="7" style="text-align:center;padding:20px;"><button class="btn btn-primary" onclick="showAddAppointmentForm()"><i class="fas fa-plus"></i> Add New Appointment</button></td></tr></tbody></table>';
          container.innerHTML = html;
          updateDashboardStats();
        } catch (e) {
          container.innerHTML = "<p>Error loading appointments</p>";
          console.error(e);
        }
      }

      function toggleEditAppointment(id) {
        const row = document.getElementById(`appt-row-${id}`);
        const editBtn = document.getElementById(`edit-appt-${id}`);
        const staffSelect = row.querySelector('[data-field="staff_id"]');
        const statusSelect = row.querySelector('[data-field="status"]');
        const staffDisplay = row.querySelector(".staff-display");
        const statusDisplay = row.querySelector(".status-display");

        if (editBtn.dataset.editing === "true") {
          const staffId = staffSelect.value;
          const status = statusSelect.value;

          const promises = [];

          if (staffId !== staffSelect.dataset.originalValue) {
            promises.push(
              fetch(`/api/appointments/${id}/staff`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ staff_id: staffId || null }),
              })
            );
          }

          if (status !== statusSelect.dataset.originalValue) {
            promises.push(
              fetch(`/api/appointments/${id}/status`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ status }),
              })
            );
          }

          if (promises.length > 0) {
            Promise.all(promises)
              .then((responses) => {
                const allOk = responses.every((resp) => resp.ok);
                if (!allOk) throw new Error("Failed to update appointment");

                editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
                editBtn.dataset.editing = "false";
                loadAppointments();
              })
              .catch((e) => {
                alert("Error: " + e.message);
                editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
                editBtn.dataset.editing = "false";
              });
          } else {
            editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
            editBtn.dataset.editing = "false";
            loadAppointments();
          }
        } else {
          editBtn.innerHTML = '<i class="fas fa-save"></i>';
          editBtn.dataset.editing = "true";

          staffSelect.dataset.originalValue = staffSelect.value;
          statusSelect.dataset.originalValue = statusSelect.value;

          if (staffDisplay) staffDisplay.style.display = "none";
          if (statusDisplay) statusDisplay.style.display = "none";

          staffSelect.style.display = "block";
          statusSelect.style.display = "block";

          [staffSelect, statusSelect].forEach((select) => {
            select.style.width = "100%";
            select.style.padding = "6px";
            select.style.border = "1px solid #ddd";
            select.style.borderRadius = "4px";
            select.style.background = "#fff";
          });
        }
      }

      async function updateAppointmentStatus(id, status) {
        try {
          const resp = await fetch(`/api/appointments/${id}/status`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ status }),
          });

          if (!resp.ok) {
            const data = await resp.json();
            throw new Error(data.error || "Failed to update status");
          }

          loadAppointments();
        } catch (e) {
          alert("Error: " + e.message);
        }
      }

      function toggleNotes(appointmentId) {
        const notesRow = document.getElementById(`notes-row-${appointmentId}`);
        const arrow = document.getElementById(`arrow-${appointmentId}`);

        if (notesRow && arrow) {
          notesRow.classList.toggle("show");
          arrow.classList.toggle("expanded");
        }
      }

      async function deleteAppointment(id) {
        if (!confirm("Delete this appointment?")) return;

        try {
          const resp = await fetch(`/api/appointments/${id}`, {
            method: "DELETE",
          });
          if (!resp.ok) throw new Error("Failed to delete");
          loadAppointments();
        } catch (e) {
          alert("Error: " + e.message);
        }
      }

      async function showAddAppointmentForm() {
        const container = document.getElementById("appointmentsList");

        try {
          const [servicesResp, staffResp, customersResp] = await Promise.all([
            fetch("/api/all-services"),
            fetch("/api/staff"),
            fetch("/api/customers"),
          ]);

          const allServices = await servicesResp.json();
          const staff = await staffResp.json();
          const customers = await customersResp.json();

          const regularServices = allServices.filter((s) => !s.is_premium);
          const premiumServices = allServices.filter((s) => s.is_premium);

          let serviceOptions = '<option value="">Select Service</option>';
          if (regularServices.length > 0) {
            serviceOptions += '<optgroup label="Regular Services">';
            serviceOptions += regularServices
              .map(
                (s) =>
                  `<option value="${s.service_id}">${s.service_name} (₹${s.price})</option>`
              )
              .join("");
            serviceOptions += "</optgroup>";
          }
          if (premiumServices.length > 0) {
            serviceOptions += '<optgroup label="Premium Services">';
            serviceOptions += premiumServices
              .map(
                (s) =>
                  `<option value="${s.service_id}">${s.service_name} (₹${s.price})</option>`
              )
              .join("");
            serviceOptions += "</optgroup>";
          }

          const form = `
                    <div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                        <h4>Add New Appointment</h4>
                        <form id="addAppointmentForm" style="display:grid;gap:15px;margin-top:15px;">
                            <div style="display:grid;gap:10px;">
                                <label style="font-weight:500;">Customer:</label>
                                <select id="new_appt_customer" required style="padding:12px;border:2px solid #ddd;border-radius:5px;">
                                    <option value="">Select Customer</option>
                                    ${customers
                                      .map(
                                        (c) =>
                                          `<option value="${c.customer_id}">${c.full_name} - ${c.phone}</option>`
                                      )
                                      .join("")}
                                </select>
                                <p style="font-size:0.9rem;color:#666;margin:0;">Or <a href="#" onclick="event.preventDefault(); showAddCustomerInline();" style="color:var(--accent);">add new customer</a></p>
                            </div>
                            
                            <div id="inlineCustomerForm" style="display:none;background:#fff;padding:15px;border-radius:5px;border:2px solid var(--pastel-pink);">
                                <h5 style="margin-bottom:10px;">New Customer Details:</h5>
                                <input type="text" id="inline_customer_name" placeholder="Full Name" style="padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:10px;width:100%;" />
                                <input type="tel" id="inline_customer_phone" placeholder="Phone Number" style="padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:10px;width:100%;" />
                                <input type="email" id="inline_customer_email" placeholder="Email Address" style="padding:10px;border:1px solid #ddd;border-radius:5px;margin-bottom:10px;width:100%;" />
                            </div>
                            
                            <div style="display:grid;gap:10px;">
                                <label style="font-weight:500;">Service:</label>
                                <select id="new_appt_service" required style="padding:12px;border:2px solid #ddd;border-radius:5px;">
                                    ${serviceOptions}
                                </select>
                            </div>
                            
                            <div style="display:grid;gap:10px;">
                                <label style="font-weight:500;">Staff (Optional):</label>
                                <select id="new_appt_staff" style="padding:12px;border:2px solid #ddd;border-radius:5px;">
                                    <option value="">Auto-assign available staff</option>
                                    ${staff
                                      .map(
                                        (s) =>
                                          `<option value="${s.staff_id}">${s.full_name} - ${s.role}</option>`
                                      )
                                      .join("")}
                                </select>
                            </div>
                            
                            <div style="display:grid;gap:10px;">
                                <label style="font-weight:500;">Date:</label>
                                <input type="date" id="new_appt_date" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" min="${
                                  new Date().toISOString().split("T")[0]
                                }" />
                            </div>
                            
                            <div style="display:grid;gap:10px;">
                                <label style="font-weight:500;">Time:</label>
                                <input type="time" id="new_appt_time" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                            </div>
                            
                            <div style="display:grid;gap:10px;">
                                <label style="font-weight:500;">Notes (Optional):</label>
                                <textarea id="new_appt_notes" placeholder="Any special instructions or requests..." style="padding:12px;border:2px solid #ddd;border-radius:5px;min-height:80px;resize:vertical;font-family:'Poppins',sans-serif;"></textarea>
                            </div>
                            
                            <div style="display:flex;gap:10px;">
                                <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Create Appointment</button>
                                <button type="button" class="btn btn-outline" onclick="loadAppointments()">Cancel</button>
                            </div>
                        </form>
                    </div>
                `;
          container.innerHTML += form;

          document
            .getElementById("addAppointmentForm")
            .addEventListener("submit", async function (e) {
              e.preventDefault();

              let customerId =
                document.getElementById("new_appt_customer").value;
              const serviceId =
                document.getElementById("new_appt_service").value;
              const staffId =
                document.getElementById("new_appt_staff").value || null;
              const date = document.getElementById("new_appt_date").value;
              const time = document.getElementById("new_appt_time").value;
              const notes =
                document.getElementById("new_appt_notes").value || null;

              const inlineForm = document.getElementById("inlineCustomerForm");
              if (inlineForm.style.display !== "none") {
                const name = document.getElementById(
                  "inline_customer_name"
                ).value;
                const phone = document.getElementById(
                  "inline_customer_phone"
                ).value;
                const email = document.getElementById(
                  "inline_customer_email"
                ).value;

                if (!name || !phone || !email) {
                  alert("Please fill in all customer details");
                  return;
                }

                try {
                  const custResp = await fetch("/api/customers", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ full_name: name, phone, email }),
                  });

                  if (!custResp.ok) {
                    const data = await custResp.json();
                    throw new Error(data.error || "Failed to create customer");
                  }

                  const custData = await custResp.json();
                  customerId = custData.customer_id;
                } catch (e) {
                  alert("Error creating customer: " + e.message);
                  return;
                }
              }

              if (!customerId) {
                alert("Please select a customer or add a new one");
                return;
              }

              try {
                const apptResp = await fetch("/api/appointments", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    customer_id: customerId,
                    service_id: serviceId,
                    staff_id: staffId,
                    appointment_date: date,
                    appointment_time: time,
                    notes: notes,
                  }),
                });

                if (!apptResp.ok) {
                  const data = await apptResp.json();
                  throw new Error(data.error || "Failed to create appointment");
                }

                alert("Appointment created successfully!");
                loadAppointments();
                updateDashboardStats();
              } catch (e) {
                alert("Error: " + e.message);
              }
            });
        } catch (e) {
          alert("Error loading form data: " + e.message);
        }
      }

      function showAddCustomerInline() {
        const inlineForm = document.getElementById("inlineCustomerForm");
        const customerSelect = document.getElementById("new_appt_customer");

        if (inlineForm.style.display === "none") {
          inlineForm.style.display = "block";
          customerSelect.disabled = true;
          customerSelect.style.opacity = "0.5";
        } else {
          inlineForm.style.display = "none";
          customerSelect.disabled = false;
          customerSelect.style.opacity = "1";
        }
      }

      function showServices() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("servicesContent").style.display = "block";
        loadServicesAdmin();
      }

      async function loadServicesAdmin() {
        const list = document.getElementById("servicesList");
        list.innerHTML = "Loading...";

        try {
          const resp = await fetch("/api/services");
          const services = await resp.json();

          let html =
            "<table><thead><tr><th>Name</th><th>Price</th><th>Duration (min)</th><th>Description</th><th>Actions</th></tr></thead><tbody>";

          services.forEach((s) => {
            const description = s.description || "";
            const truncatedDesc =
              description.length > 30
                ? description.substring(0, 30) + "..."
                : description;

            html += `<tr id="svc-row-${s.service_id}">
                        <td><input data-id="${s.service_id}" data-field="service_name" value="${s.service_name}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${s.service_id}" data-field="price" type="number" step="0.01" value="${s.price}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${s.service_id}" data-field="duration_minutes" type="number" value="${s.duration_minutes}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${s.service_id}" data-field="description" value="${description}" disabled style="width:100%;background:transparent;border:none;display:none;" />
                            <span class="truncated-text" title="${description}">${truncatedDesc}</span></td>
                        <td style="white-space:nowrap;">
                            <button class="action-btn edit-btn" onclick="toggleEditService(${s.service_id})" id="edit-svc-${s.service_id}" title="Edit">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteService(${s.service_id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
          });

          html +=
            '<tr><td colspan="5" style="text-align:center;padding:20px;"><button class="btn btn-primary" onclick="showAddServiceForm()"><i class="fas fa-plus"></i> Add Regular Service</button></td></tr></tbody></table>';

          list.innerHTML = html;
          updateDashboardStats();
        } catch (e) {
          list.innerHTML = "<p>Error loading services</p>";
        }
      }

      function toggleEditService(id) {
        const row = document.getElementById(`svc-row-${id}`);
        const inputs = row.querySelectorAll("input[data-id]");
        const editBtn = document.getElementById(`edit-svc-${id}`);
        const truncatedSpan = row.querySelector(".truncated-text");
        const descriptionInput = row.querySelector(
          'input[data-field="description"]'
        );

        if (editBtn.dataset.editing === "true") {
          const payload = {};
          inputs.forEach((inp) => {
            payload[inp.dataset.field] = inp.value;
          });
          payload.is_premium = false;

          fetch(`/api/services/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          })
            .then((resp) => {
              if (!resp.ok) throw new Error("Failed to update");
              editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
              editBtn.dataset.editing = "false";
              inputs.forEach((inp) => {
                inp.disabled = true;
                inp.style.background = "transparent";
                inp.style.border = "none";
              });
              loadServicesAdmin();
            })
            .catch((e) => alert("Error: " + e.message));
        } else {
          inputs.forEach((inp) => {
            inp.disabled = false;
            inp.style.background = "#fff";
            inp.style.border = "1px solid #ddd";
            inp.style.borderRadius = "5px";
            inp.style.padding = "8px";
          });

          if (truncatedSpan && descriptionInput) {
            truncatedSpan.style.display = "none";
            descriptionInput.style.display = "block";
          }
          editBtn.innerHTML = '<i class="fas fa-save"></i>';
          editBtn.dataset.editing = "true";
        }
      }

      async function deleteService(id) {
        if (!confirm("Delete this service?")) return;

        try {
          const resp = await fetch(`/api/services/${id}`, { method: "DELETE" });
          if (!resp.ok) throw new Error("Failed to delete");
          loadServicesAdmin();
        } catch (e) {
          alert("Error: " + e.message);
        }
      }

      function showAddServiceForm() {
        const list = document.getElementById("servicesList");
        const form = `
                <div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                    <h4>Add New Regular Service</h4>
                    <form id="addServiceForm" style="display:grid;gap:15px;margin-top:15px;">
                        <input type="text" id="new_svc_name" placeholder="Service Name" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="number" id="new_svc_price" placeholder="Price" step="0.01" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="number" id="new_svc_duration" placeholder="Duration (minutes)" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="text" id="new_svc_desc" placeholder="Description" style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <div style="display:flex;gap:10px;">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn" onclick="loadServicesAdmin()" style="background:#6c757d;color:white;">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        list.innerHTML += form;

        document
          .getElementById("addServiceForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const payload = {
              service_name: document
                .getElementById("new_svc_name")
                .value.trim(),
              price: parseFloat(document.getElementById("new_svc_price").value),
              duration_minutes: parseInt(
                document.getElementById("new_svc_duration").value
              ),
              description:
                document.getElementById("new_svc_desc").value.trim() || null,
              is_premium: false,
            };

            console.log("Sending service payload:", payload);

            try {
              const resp = await fetch("/api/services", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });

              if (!resp.ok) {
                const errorData = await resp.json();
                throw new Error(errorData.error || "Failed to create service");
              }

              const result = await resp.json();
              alert("Service created successfully!");
              loadServicesAdmin();
            } catch (e) {
              console.error("Error creating service:", e);
              alert("Error: " + e.message);
              console.error("Error creating service:", e);
              alert("Error: " + e.message);
            }
          });
      }

      function showPremium() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("premiumContent").style.display = "block";
        loadPremiumAdmin();
      }

      async function loadPremiumAdmin() {
        const list = document.getElementById("premiumList");
        list.innerHTML = "Loading...";

        try {
          const resp = await fetch("/api/premium");
          const services = await resp.json();

          let html =
            "<table><thead><tr><th>Name</th><th>Price</th><th>Duration (min)</th><th>Description</th><th>Actions</th></tr></thead><tbody>";

          services.forEach((s) => {
            const description = s.description || "";
            const truncatedDesc =
              description.length > 30
                ? description.substring(0, 30) + "..."
                : description;

            html += `<tr id="prem-row-${s.service_id}">
                        <td><input data-id="${s.service_id}" data-field="service_name" value="${s.service_name}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${s.service_id}" data-field="price" type="number" step="0.01" value="${s.price}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${s.service_id}" data-field="duration_minutes" type="number" value="${s.duration_minutes}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${s.service_id}" data-field="description" value="${description}" disabled style="width:100%;background:transparent;border:none;display:none;" />
                            <span class="truncated-text" title="${description}">${truncatedDesc}</span></td>
                        <td style="white-space:nowrap;">
                            <button class="action-btn edit-btn" onclick="toggleEditPremium(${s.service_id})" id="edit-prem-${s.service_id}" title="Edit">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deletePremium(${s.service_id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
          });

          html +=
            '<tr><td colspan="5" style="text-align:center;padding:20px;"><button class="btn btn-primary" onclick="showAddPremiumForm()"><i class="fas fa-plus"></i> Add Premium Service</button></td></tr></tbody></table>';

          list.innerHTML = html;
          updateDashboardStats();
        } catch (e) {
          list.innerHTML = "<p>Error loading premium services</p>";
          console.error("Error loading premium services:", e);
        }
      }

      function toggleEditPremium(id) {
        const row = document.getElementById(`prem-row-${id}`);
        const inputs = row.querySelectorAll("input[data-id]");
        const editBtn = document.getElementById(`edit-prem-${id}`);
        const truncatedSpan = row.querySelector(".truncated-text");
        const descriptionInput = row.querySelector(
          'input[data-field="description"]'
        );

        if (editBtn.dataset.editing === "true") {
          const payload = {};
          inputs.forEach((inp) => {
            payload[inp.dataset.field] = inp.value;
          });
          payload.is_premium = true;

          console.log("Updating premium service:", payload);

          fetch(`/api/services/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          })
            .then((resp) => {
              if (!resp.ok) {
                return resp.json().then((data) => {
                  throw new Error(data.error || "Failed to update");
                });
              }
              editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
              editBtn.dataset.editing = "false";
              inputs.forEach((inp) => {
                inp.disabled = true;
                inp.style.background = "transparent";
                inp.style.border = "none";
              });
              loadPremiumAdmin();
            })
            .catch((e) => {
              console.error("Error updating premium service:", e);
              alert("Error: " + e.message);
            });
        } else {
          inputs.forEach((inp) => {
            inp.disabled = false;
            inp.style.background = "#fff";
            inp.style.border = "1px solid #ddd";
            inp.style.borderRadius = "5px";
            inp.style.padding = "8px";
          });
          if (truncatedSpan && descriptionInput) {
            truncatedSpan.style.display = "none";
            descriptionInput.style.display = "block";
          }
          editBtn.innerHTML = '<i class="fas fa-save"></i>';
          editBtn.dataset.editing = "true";
        }
      }

      async function deletePremium(id) {
        if (!confirm("Delete this premium service?")) return;

        try {
          const resp = await fetch(`/api/services/${id}`, { method: "DELETE" });
          if (!resp.ok) {
            const data = await resp.json();
            throw new Error(data.error || "Failed to delete");
          }
          loadPremiumAdmin();
          updateDashboardStats();
        } catch (e) {
          console.error("Error deleting premium service:", e);
          alert("Error: " + e.message);
        }
      }

      function showAddPremiumForm() {
        const list = document.getElementById("premiumList");
        const form = `
                <div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                    <h4>Add New Premium Service</h4>
                    <form id="addPremiumForm" style="display:grid;gap:15px;margin-top:15px;">
                        <input type="text" id="new_prem_name" placeholder="Service Name" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="number" id="new_prem_price" placeholder="Price" step="0.01" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="number" id="new_prem_duration" placeholder="Duration (minutes)" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <textarea id="new_prem_desc" placeholder="Description (optional)" style="padding:12px;border:2px solid #ddd;border-radius:5px;min-height:80px;resize:vertical;font-family:'Poppins',sans-serif;"></textarea>
                        <div style="background:linear-gradient(135deg,var(--pastel-pink),var(--pastel-lavender));padding:15px;border-radius:8px;color:var(--dark-text);text-align:center;">
                            <i class="fas fa-crown" style="color:var(--accent);font-size:1.5rem;"></i>
                            <p style="margin:5px 0 0 0;font-weight:600;">This will be added as a Premium Service</p>
                        </div>
                        <div style="display:flex;gap:10px;">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Premium Service</button>
                            <button type="button" class="btn" onclick="loadPremiumAdmin()" style="background:#6c757d;color:white;">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        list.innerHTML += form;

        document
          .getElementById("addPremiumForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const payload = {
              service_name: document
                .getElementById("new_prem_name")
                .value.trim(),
              price: parseFloat(
                document.getElementById("new_prem_price").value
              ),
              duration_minutes: parseInt(
                document.getElementById("new_prem_duration").value
              ),
              description:
                document.getElementById("new_prem_desc").value.trim() || null,
              is_premium: true,
            };

            console.log("Creating premium service:", payload);

            try {
              const resp = await fetch("/api/services", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });

              if (!resp.ok) {
                const errorData = await resp.json();
                throw new Error(
                  errorData.error || "Failed to create premium service"
                );
              }

              const result = await resp.json();
              alert("Premium service created successfully!");
              loadPremiumAdmin();
              updateDashboardStats();
            } catch (e) {
              console.error("Error creating premium service:", e);
              alert("Error: " + e.message);
            }
          });
      }

      // STAFF
      function showStaff() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("staffContent").style.display = "block";
        loadStaffAdmin();
      }

      async function loadStaffAdmin() {
        const list = document.getElementById("staffList");
        list.innerHTML = "Loading...";

        try {
          const resp = await fetch("/api/staff");
          const staff = await resp.json();

          let html =
            '<table style="table-layout: fixed; width: 100%;"><thead><tr><th style="width: 20%;">Name</th><th style="width: 15%;">Role</th><th style="width: 15%;">Phone</th><th style="width: 25%;">Email</th><th style="width: 12%;">Salary</th><th style="width: 13%;">Actions</th></tr></thead><tbody>';

          staff.forEach((s) => {
            const role = s.role || "";
            const email = s.email || "";
            const name = s.full_name || "";
            const salary = s.salary || 0;

            const needsRoleTooltip = role.length > 15;
            const needsEmailTooltip = email.length > 18;
            const needsNameTooltip = name.length > 25;

            const truncatedRole = needsRoleTooltip
              ? role.substring(0, 15) + "..."
              : role;
            const truncatedEmail = needsEmailTooltip
              ? email.substring(0, 18) + "..."
              : email;
            const truncatedName = needsNameTooltip
              ? name.substring(0, 25) + "..."
              : name;

            const formattedSalary =
              salary % 1 === 0
                ? Math.floor(salary).toString()
                : salary.toString();

            html += `<tr id="staff-row-${s.staff_id}">
                        <td style="word-wrap: break-word;">
                            <input data-id="${
                              s.staff_id
                            }" data-field="full_name" value="${name}" disabled style="width:100%;background:transparent;border:none;display:none;" />
                            <span class="name-display ${
                              needsNameTooltip ? "truncated-text" : ""
                            }" ${
              needsNameTooltip ? `title="${name}"` : ""
            }>${truncatedName}</span>
                        </td>
                        <td style="word-wrap: break-word;">
                            <input data-id="${
                              s.staff_id
                            }" data-field="role" value="${role}" disabled style="width:100%;background:transparent;border:none;display:none;" />
                            <span class="role-display ${
                              needsRoleTooltip ? "truncated-text" : ""
                            }" ${
              needsRoleTooltip ? `title="${role}"` : ""
            }>${truncatedRole}</span>
                        </td>
                        <td><input data-id="${
                          s.staff_id
                        }" data-field="phone" value="${
              s.phone
            }" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td style="word-wrap: break-word;">
                            <input data-id="${
                              s.staff_id
                            }" data-field="email" value="${email}" disabled style="width:100%;background:transparent;border:none;display:none;" />
                            <span class="email-display ${
                              needsEmailTooltip ? "truncated-text" : ""
                            }" ${
              needsEmailTooltip ? `title="${email}"` : ""
            }>${truncatedEmail}</span>
                        </td>
                        <td>
                            <input data-id="${
                              s.staff_id
                            }" data-field="salary" type="number" step="0.01" min="0" value="${salary}" disabled style="width:100%;background:transparent;border:none;display:none;" />
                            <span class="salary-display">${formattedSalary}</span>
                        </td>
                        <td style="white-space:nowrap;">
                            <button class="action-btn edit-btn" onclick="toggleEditStaff(${
                              s.staff_id
                            })" id="edit-staff-${s.staff_id}" title="Edit">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteStaff(${
                              s.staff_id
                            })" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
          });

          html +=
            '<tr><td colspan="6" style="text-align:center;padding:20px;"><button class="btn btn-primary" onclick="showAddStaffForm()"><i class="fas fa-plus"></i> Add Staff</button></td></tr></tbody></table>';

          list.innerHTML = html;
          updateDashboardStats();
        } catch (e) {
          list.innerHTML = "<p>Error loading staff</p>";
        }
      }

      function toggleEditStaff(id) {
        const row = document.getElementById(`staff-row-${id}`);
        const inputs = row.querySelectorAll("input[data-id]");
        const editBtn = document.getElementById(`edit-staff-${id}`);

        const nameDisplay = row.querySelector(".name-display");
        const roleDisplay = row.querySelector(".role-display");
        const emailDisplay = row.querySelector(".email-display");
        const salaryDisplay = row.querySelector(".salary-display");

        const nameInput = row.querySelector('input[data-field="full_name"]');
        const roleInput = row.querySelector('input[data-field="role"]');
        const emailInput = row.querySelector('input[data-field="email"]');
        const salaryInput = row.querySelector('input[data-field="salary"]');

        if (editBtn.dataset.editing === "true") {
          if (salaryInput && parseFloat(salaryInput.value) < 0) {
            alert("Salary cannot be negative");
            return;
          }

          const payload = {};
          inputs.forEach((inp) => {
            payload[inp.dataset.field] = inp.value;
          });

          fetch(`/api/staff/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          })
            .then((resp) => {
              if (!resp.ok) throw new Error("Failed to update");
              editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
              editBtn.dataset.editing = "false";
              editBtn.title = "Edit";
              inputs.forEach((inp) => {
                inp.disabled = true;
                inp.style.background = "transparent";
                inp.style.border = "none";
                inp.style.display = "none";
              });

              if (nameDisplay) nameDisplay.style.display = "block";
              if (roleDisplay) roleDisplay.style.display = "block";
              if (emailDisplay) emailDisplay.style.display = "block";
              if (salaryDisplay) salaryDisplay.style.display = "block";

              loadStaffAdmin();
            })
            .catch((e) => alert("Error: " + e.message));
        } else {
          inputs.forEach((inp) => {
            inp.disabled = false;
            inp.style.background = "#fff";
            inp.style.border = "1px solid #ddd";
            inp.style.borderRadius = "5px";
            inp.style.padding = "8px";
            inp.style.display = "block";
          });

          if (nameDisplay) nameDisplay.style.display = "none";
          if (roleDisplay) roleDisplay.style.display = "none";
          if (emailDisplay) emailDisplay.style.display = "none";
          if (salaryDisplay) salaryDisplay.style.display = "none";

          editBtn.innerHTML = '<i class="fas fa-save"></i>';
          editBtn.dataset.editing = "true";
          editBtn.title = "Save";
        }
      }

      async function deleteStaff(id) {
        if (!confirm("Delete this staff member?")) return;

        try {
          const resp = await fetch(`/api/staff/${id}`, { method: "DELETE" });
          if (!resp.ok) throw new Error("Failed to delete");
          loadStaffAdmin();
        } catch (e) {
          alert("Error: " + e.message);
        }
      }

      function showAddStaffForm() {
        const list = document.getElementById("staffList");
        const form = `
                <div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                    <h4>Add New Staff Member</h4>
                    <form id="addStaffForm" style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px;margin-top:15px;">
                        <input type="text" id="new_staff_name" placeholder="Full Name" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="text" id="new_staff_role" placeholder="Role" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="text" id="new_staff_phone" placeholder="Phone" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="email" id="new_staff_email" placeholder="Email" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="number" id="new_staff_salary" placeholder="Salary" step="0.01" min="0" style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <div style="grid-column:1/-1;display:flex;gap:10px;">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn" onclick="loadStaffAdmin()" style="background:#6c757d;color:white;">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        list.innerHTML += form;

        document
          .getElementById("addStaffForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();

            const salaryValue =
              parseFloat(document.getElementById("new_staff_salary").value) ||
              0;
            if (salaryValue < 0) {
              alert("Salary cannot be negative");
              return;
            }

            const payload = {
              full_name: document.getElementById("new_staff_name").value,
              role: document.getElementById("new_staff_role").value,
              phone: document.getElementById("new_staff_phone").value,
              email: document.getElementById("new_staff_email").value,
              salary: salaryValue,
            };

            try {
              const resp = await fetch("/api/staff", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });
              if (!resp.ok) throw new Error("Failed to create");
              loadStaffAdmin();
            } catch (e) {
              alert("Error: " + e.message);
            }
          });
      }

      function showMessages() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("messagesContent").style.display = "block";
        loadMessages();
      }

      async function loadMessages() {
        const container = document.getElementById("messagesList");
        container.innerHTML = "<p>Loading...</p>";

        try {
          const resp = await fetch("/api/messages");
          const contacts = await resp.json();

          if (!contacts.length) {
            container.innerHTML = "<p>No messages found.</p>";
            return;
          }

          let html =
            "<table><thead><tr><th>Name</th><th>Email</th><th>Subject</th><th>Message</th><th>Date</th><th>Actions</th></tr></thead><tbody>";

          contacts.forEach((c) => {
            const date = c.created_at
              ? new Date(c.created_at).toLocaleString()
              : "";
            const shortMsg =
              c.message.length > 50
                ? c.message.substring(0, 50) + "..."
                : c.message;

            html += `<tr>
                        <td>${c.name}</td>
                        <td>${c.email}</td>
                        <td>${c.subject || "-"}</td>
                        <td title="${c.message}">${shortMsg}</td>
                        <td>${date}</td>
                        <td>
                            <button class="action-btn delete-btn" onclick="deleteMessage(${
                              c.message_id
                            })" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
          });

          html += "</tbody></table>";
          container.innerHTML = html;
        } catch (e) {
          container.innerHTML = "<p>Error loading messages</p>";
          console.error(e);
        }
      }

      async function deleteMessage(id) {
        if (!confirm("Delete this message?")) return;

        try {
          const resp = await fetch(`/api/messages/${id}`, { method: "DELETE" });
          if (!resp.ok) throw new Error("Failed to delete");
          loadMessages();
        } catch (e) {
          alert("Error: " + e.message);
        }
      }

      // CUSTOMERS
      function showCustomersTab() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("customersTabContent").style.display = "block";
        loadCustomersAdmin();
      }

      async function loadCustomersAdmin() {
        const list = document.getElementById("customersList");
        list.innerHTML = "Loading...";

        try {
          const resp = await fetch("/api/customers");
          const customers = await resp.json();

          let html =
            "<table><thead><tr><th>Name</th><th>Phone</th><th>Email</th><th>Actions</th></tr></thead><tbody>";

          customers.forEach((c) => {
            html += `<tr id="customer-row-${c.customer_id}">
                        <td><input data-id="${c.customer_id}" data-field="full_name" value="${c.full_name}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${c.customer_id}" data-field="phone" value="${c.phone}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td><input data-id="${c.customer_id}" data-field="email" value="${c.email}" disabled style="width:100%;background:transparent;border:none;" /></td>
                        <td>
                            <button class="action-btn edit-btn" id="edit-customer-${c.customer_id}" data-editing="false" onclick="toggleEditCustomer(${c.customer_id})" title="Edit">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteCustomer(${c.customer_id})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
          });

          html +=
            '<tr><td colspan="4" style="text-align:center;padding:20px;"><button class="btn btn-primary" onclick="showAddCustomerForm()"><i class="fas fa-plus"></i> Add Customer</button></td></tr></tbody></table>';

          list.innerHTML = html;
        } catch (e) {
          list.innerHTML = "<p>Error loading customers</p>";
        }
      }

      function toggleEditCustomer(id) {
        const row = document.getElementById(`customer-row-${id}`);
        const inputs = row.querySelectorAll("input[data-id]");
        const editBtn = document.getElementById(`edit-customer-${id}`);

        if (editBtn.dataset.editing === "true") {
          const payload = {};
          inputs.forEach((inp) => {
            payload[inp.dataset.field] = inp.value;
          });

          fetch(`/api/customers/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          })
            .then((resp) => {
              if (!resp.ok) {
                return resp.json().then((data) => {
                  throw new Error(data.error || "Failed to update");
                });
              }
              editBtn.innerHTML = '<i class="fas fa-pencil-alt"></i>';
              editBtn.dataset.editing = "false";
              inputs.forEach((inp) => {
                inp.disabled = true;
                inp.style.background = "transparent";
                inp.style.border = "none";
              });
              loadCustomersAdmin();
            })
            .catch((e) => alert("Error: " + e.message));
        } else {
          inputs.forEach((inp) => {
            inp.disabled = false;
            inp.style.background = "#fff";
            inp.style.border = "1px solid #ddd";
            inp.style.borderRadius = "5px";
            inp.style.padding = "8px";
          });
          editBtn.innerHTML = '<i class="fas fa-save"></i>';
          editBtn.dataset.editing = "true";
        }
      }

      async function deleteCustomer(id) {
        if (
          !confirm(
            "Delete this customer? This will also delete all their appointments."
          )
        )
          return;

        try {
          const resp = await fetch(`/api/customers/${id}`, {
            method: "DELETE",
          });
          if (!resp.ok) {
            const data = await resp.json();
            throw new Error(data.error || "Failed to delete customer");
          }
          loadCustomersAdmin();
          updateDashboardStats();
        } catch (e) {
          alert("Error: " + e.message);
        }
      }

      function showAddCustomerForm() {
        const list = document.getElementById("customersList");
        const form = `
                <div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-top:20px;">
                    <h4>Add New Customer</h4>
                    <form id="addCustomerForm" style="display:grid;gap:15px;margin-top:15px;">
                        <input type="text" id="new_customer_name" placeholder="Full Name" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="tel" id="new_customer_phone" placeholder="Phone Number" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <input type="email" id="new_customer_email" placeholder="Email Address" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                        <div style="display:flex;gap:10px;">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Customer</button>
                            <button type="button" class="btn btn-outline" onclick="loadCustomersAdmin()">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
        list.innerHTML += form;

        document
          .getElementById("addCustomerForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            const payload = {
              full_name: document.getElementById("new_customer_name").value,
              phone: document.getElementById("new_customer_phone").value,
              email: document.getElementById("new_customer_email").value,
            };

            try {
              const resp = await fetch("/api/customers", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });
              if (!resp.ok) {
                const data = await resp.json();
                throw new Error(data.error || "Failed to create customer");
              }
              const result = await resp.json();
              if (result.reused) {
                alert(
                  "Customer with this phone or email already exists. Existing customer information will be used."
                );
              } else {
                alert("Customer added successfully!");
              }
              loadCustomersAdmin();
              updateDashboardStats();
            } catch (e) {
              alert("Error: " + e.message);
            }
          });
      }

      // ADMINS
      function showAdminsTab() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("adminsTabContent").style.display = "block";
        loadAdmins();
      }

      async function loadAdmins() {
        const list = document.getElementById("adminsList");
        list.innerHTML = "Loading...";

        try {
          const resp = await fetch("/api/admins");
          const admins = await resp.json();

          let html = `
                    <div style="background:#f8f9fa;padding:20px;border-radius:10px;margin-bottom:20px;">
                        <h4>Add New Admin</h4>
                        <form id="addAdminForm" style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px;margin-top:15px;">
                            <input type="text" id="adm_username" placeholder="Username" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                            <div class="password-field">
                                <input type="password" id="adm_password" placeholder="Password" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                                <button type="button" class="toggle-password" onclick="togglePassword('adm_password')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <button type="submit" class="btn btn-primary" style="grid-column:1/-1;"><i class="fas fa-user-plus"></i> Create Admin</button>
                        </form>
                    </div>
                    <h4>Existing Admins</h4>
                    <table><thead><tr><th>Username</th><th>Created</th><th>Actions</th></tr></thead><tbody>`;

          admins.forEach((a) => {
            const created = a.created_at
              ? new Date(a.created_at).toLocaleString()
              : "";
            html += `<tr>
                        <td>${a.username}</td>
                        <td>${created}</td>
                        <td style="white-space:nowrap;">
                            <button class="action-btn edit-btn" onclick="showChangePasswordDialog(${a.admin_id}, '${a.username}')" title="Change Password">
                                <i class="fas fa-key"></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="showDeleteAdminDialog(${a.admin_id}, '${a.username}')" title="Delete Admin">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>`;
          });

          html += "</tbody></table>";
          list.innerHTML = html;

          document
            .getElementById("addAdminForm")
            .addEventListener("submit", async function (e) {
              e.preventDefault();
              const username = document.getElementById("adm_username").value;
              const password = document.getElementById("adm_password").value;

              try {
                const resp = await fetch("/api/admins", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ username, password }),
                });
                if (!resp.ok) {
                  const data = await resp.json();
                  throw new Error(data.error || "Failed to create admin");
                }
                alert("Admin created successfully");
                loadAdmins();
              } catch (e) {
                alert("Error: " + e.message);
              }
            });
        } catch (e) {
          list.innerHTML = "<p>Error loading admins</p>";
        }
      }

      function showDeleteAdminDialog(adminId, username) {
        const dialog = `
                <div id="deleteAdminModal" class="modal-overlay">
                    <div class="modal-content">
                        <h3 class="modal-header">
                            <i class="fas fa-exclamation-triangle"></i>
                            Delete Admin
                        </h3>
                        <p>Are you sure you want to delete admin <strong>${username}</strong>?</p>
                        <p style="color:#666;font-size:14px;margin-bottom:20px;">This action cannot be undone. Please enter the admin's password to confirm deletion.</p>
                        
                        <form id="deleteAdminForm">
                            <div style="margin:20px 0;">
                                <label for="adminPasswordVerify" style="display:block;margin-bottom:8px;font-weight:500;">Admin Password:</label>
                                <div class="password-field">
                                    <input type="password" id="adminPasswordVerify" placeholder="Enter ${username}'s password" required style="padding:12px;border:2px solid #ddd;border-radius:5px;" />
                                    <button type="button" class="toggle-password" onclick="togglePassword('adminPasswordVerify')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div style="width:100%;padding:12px;border:2px solid #ddd;border-radius:5px;font-size:14px;box-sizing:border-box;" />
                            </div>
                            
                            <div class="modal-buttons">
                                <button type="button" class="modal-btn modal-btn-cancel" onclick="closeDeleteAdminDialog()">
                                    Cancel
                                </button>
                                <button type="submit" class="modal-btn modal-btn-danger">
                                    <i class="fas fa-trash"></i> Delete Admin
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

        document.body.insertAdjacentHTML("beforeend", dialog);

        document
          .getElementById("deleteAdminForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            const password = document.getElementById(
              "adminPasswordVerify"
            ).value;

            try {
              const resp = await fetch(`/api/admins/${adminId}`, {
                method: "DELETE",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ password }),
              });

              if (!resp.ok) {
                const data = await resp.json();
                throw new Error(data.error || "Failed to delete admin");
              }

              alert("Admin deleted successfully");
              closeDeleteAdminDialog();
              loadAdmins();
            } catch (e) {
              alert("Error: " + e.message);
            }
          });

        setTimeout(() => {
          document.getElementById("adminPasswordVerify").focus();
        }, 100);
      }

      function closeDeleteAdminDialog() {
        const modal = document.getElementById("deleteAdminModal");
        if (modal) {
          modal.remove();
        }
      }

      function showChangePasswordDialog(adminId, username) {
        const dialog = `
                <div id="changePasswordModal" class="modal-overlay">
                    <div class="modal-content">
                        <h3 class="modal-header">
                            <i class="fas fa-key"></i>
                            Change Password for ${username}
                        </h3>
                        <p>Enter the current password and the new password to change the admin password.</p>
                        
                        <form id="changePasswordForm">
                            <div style="margin:15px 0;">
                                <label for="currentPassword" style="display:block;margin-bottom:8px;font-weight:500;">Current Password:</label>
                                <input type="password" id="currentPassword" placeholder="Enter current password" required style="width:100%;padding:12px;border:2px solid #ddd;border-radius:5px;font-size:14px;box-sizing:border-box;" />
                            </div>
                            
                            <div style="margin:15px 0;">
                                <label for="newPassword" style="display:block;margin-bottom:8px;font-weight:500;">New Password:</label>
                                <input type="password" id="newPassword" placeholder="Enter new password" required 
                                       style="width:100%;padding:12px;border:2px solid #ddd;border-radius:5px;font-size:14px;box-sizing:border-box;" />
                            </div>
                            
                            <div style="margin:15px 0;">
                                <label for="confirmNewPassword" style="display:block;margin-bottom:8px;font-weight:500;">Confirm New Password:</label>
                                <input type="password" id="confirmNewPassword" placeholder="Confirm new password" required 
                                       style="width:100%;padding:12px;border:2px solid #ddd;border-radius:5px;font-size:14px;box-sizing:border-box;" />
                            </div>
                            
                            <div class="modal-buttons">
                                <button type="button" class="modal-btn modal-btn-cancel" onclick="closeChangePasswordDialog()">
                                    Cancel
                                </button>
                                <button type="submit" class="modal-btn btn-primary" style="border:none;">
                                    <i class="fas fa-key"></i> Change Password
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

        document.body.insertAdjacentHTML("beforeend", dialog);

        document
          .getElementById("changePasswordForm")
          .addEventListener("submit", async function (e) {
            e.preventDefault();
            const currentPassword =
              document.getElementById("currentPassword").value;
            const newPassword = document.getElementById("newPassword").value;
            const confirmNewPassword =
              document.getElementById("confirmNewPassword").value;

            if (newPassword !== confirmNewPassword) {
              alert("New passwords do not match!");
              return;
            }

            if (newPassword.length < 6) {
              alert("New password must be at least 6 characters long!");
              return;
            }

            try {
              const resp = await fetch(
                `/api/admins/${adminId}/change-password`,
                {
                  method: "PUT",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    currentPassword,
                    newPassword,
                  }),
                }
              );

              if (!resp.ok) {
                const data = await resp.json();
                throw new Error(data.error || "Failed to change password");
              }

              alert("Password changed successfully!");
              closeChangePasswordDialog();
            } catch (e) {
              alert("Error: " + e.message);
            }
          });

        setTimeout(() => {
          document.getElementById("currentPassword").focus();
        }, 100);
      }

      function closeChangePasswordDialog() {
        const modal = document.getElementById("changePasswordModal");
        if (modal) {
          modal.remove();
        }
      }

      document.addEventListener("click", function (e) {
        if (e.target.id === "deleteAdminModal") {
          closeDeleteAdminDialog();
        }
        if (e.target.id === "changePasswordModal") {
          closeChangePasswordDialog();
        }
      });

      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          if (document.getElementById("deleteAdminModal")) {
            closeDeleteAdminDialog();
          }
          if (document.getElementById("changePasswordModal")) {
            closeChangePasswordDialog();
          }
        }
      });

      // REPORTS
      function showReportsTab() {
        hideAllContent();
        hideDashboardTabs();
        scrollToAdminDashboard();
        document.getElementById("reportsTabContent").style.display = "block";
        loadReportsTable();
      }

      async function loadReportsTable() {
        const container = document.getElementById("reportsTable");
        container.innerHTML = "Loading...";

        try {
          const [staffResp, svcResp, premResp, apptResp, msgResp] =
            await Promise.all([
              fetch("/api/staff"),
              fetch("/api/services"),
              fetch("/api/premium"),
              fetch("/api/appointments"),
              fetch("/api/messages"),
            ]);

          const staff = await staffResp.json();
          const services = await svcResp.json();
          const premium = await premResp.json();
          const appointments = await apptResp.json();
          const messages = await msgResp.json();

          let completed = 0,
            cancelled = 0,
            scheduled = 0;
          appointments.forEach((a) => {
            if (a.status === "Completed") completed++;
            else if (a.status === "Cancelled") cancelled++;
            else if (a.status === "Scheduled") scheduled++;
          });

          container.innerHTML = `
                    <table>
                        <thead><tr>
                            <th style="text-align:left;padding:12px;background:#f8f9fa;">Metric</th>
                            <th style="text-align:right;padding:12px;background:#f8f9fa;">Count</th>
                        </tr></thead>
                        <tbody>
                            <tr><td style="padding:10px;">Number of Staff</td><td style="text-align:right;padding:10px;">${staff.length}</td></tr>
                            <tr><td style="padding:10px;">Number of Services</td><td style="text-align:right;padding:10px;">${services.length}</td></tr>
                            <tr><td style="padding:10px;">Number of Premium Services</td><td style="text-align:right;padding:10px;">${premium.length}</td></tr>
                            <tr><td style="padding:10px;">Total Appointments</td><td style="text-align:right;padding:10px;">${appointments.length}</td></tr>
                            <tr><td style="padding:10px;">Completed Appointments</td><td style="text-align:right;padding:10px;">${completed}</td></tr>
                            <tr><td style="padding:10px;">Cancelled Appointments</td><td style="text-align:right;padding:10px;">${cancelled}</td></tr>
                            <tr><td style="padding:10px;">Pending (Scheduled)</td><td style="text-align:right;padding:10px;">${scheduled}</td></tr>
                            <tr><td style="padding:10px;">Total Messages</td><td style="text-align:right;padding:10px;">${messages.length}</td></tr>
                        </tbody>
                    </table>
                `;
        } catch (e) {
          container.innerHTML = "<p>Error loading report data</p>";
          console.error(e);
        }
      }

      function setActiveNavLink() {
        const currentPage =
          window.location.pathname.split("/").pop() || "index.html";
        const navLinks = document.querySelectorAll(".nav-link");

        navLinks.forEach((link) => {
          link.classList.remove("active");
          if (link.getAttribute("href") === currentPage) {
            link.classList.add("active");
          }
        });
      }

      window.addEventListener("DOMContentLoaded", function () {
        setActiveNavLink();
      });
    </script>
  </body>
</html>
