<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Appointment - Raddison Salon</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      :root {
        --pastel-pink: #ffd6e0;
        --pastel-lavender: #e6e6fa;
        --pastel-mint: #ffd6e0;
        --pastel-peach: #ffd6e0;
        --pastel-blue: #e6e6fa;
        --pastel-lilac: #d8bfd8;
        --dark-text: #5d5d5d;
        --accent: #ff6b8b;
        --light: #fff9fb;
        --gradient: linear-gradient(135deg, #ffd6e0, #e6e6fa);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      }

      body {
        background: var(--light);
        color: var(--dark-text);
        overflow-x: hidden;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      header {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        padding: 0.8rem 0;
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      header.scrolled {
        padding: 0.6rem 0;
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
      }

      .logo {
        font-family: "Playfair Display", serif;
        font-size: 1.8rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent), var(--pastel-lilac));
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0.5rem 0;
      }

      .logo i {
        font-size: 1.5rem;
        background: linear-gradient(135deg, var(--accent), var(--pastel-lilac));
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .nav-links {
        display: flex;
        list-style: none;
        gap: 1.2rem;
        align-items: center;
      }

      .nav-links a {
        text-decoration: none;
        color: var(--dark-text);
        font-weight: 500;
        font-size: 0.95rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        transition: all 0.3s ease;
        position: relative;
        white-space: nowrap;
      }

      .nav-links a::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 2px;
        background: var(--accent);
        transition: all 0.3s ease;
        transform: translateX(-50%);
      }

      .nav-links a:hover,
      .nav-links a.active {
        color: var(--accent);
        background: rgba(255, 107, 139, 0.08);
      }

      .nav-links a:hover::after,
      .nav-links a.active::after {
        width: 60%;
      }

      .auth-buttons {
        display: flex;
        gap: 0.8rem;
        align-items: center;
      }

      .btn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        box-shadow: var(--shadow);
        font-size: 0.9rem;
        white-space: nowrap;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--accent), #ff8fa3);
        color: white;
      }

      .btn-outline {
        background: transparent;
        border: 1.5px solid var(--pastel-lilac);
        color: var(--dark-text);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #ff8fa3, var(--accent));
      }

      .btn-outline:hover {
        background: var(--pastel-lilac);
        color: white;
        border-color: var(--pastel-lilac);
      }

      .mobile-menu-btn {
        display: none;
        flex-direction: column;
        gap: 4px;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
        position: relative;
        z-index: 1001;
      }

      .mobile-menu-btn span {
        width: 25px;
        height: 3px;
        background: var(--dark-text);
        transition: all 0.3s ease;
        border-radius: 2px;
        display: block;
      }

      .mobile-menu-btn:hover span {
        background: var(--accent);
      }

      .mobile-menu-btn.active span:nth-child(1) {
        transform: rotate(45deg) translate(7px, 7px);
      }

      .mobile-menu-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .mobile-menu-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -7px);
      }

      .page-header {
        background: linear-gradient(
          135deg,
          var(--pastel-pink) 0%,
          var(--pastel-lavender) 100%
        );
        color: var(--dark-text);
        padding: 140px 0 80px;
        text-align: center;
        margin-top: 80px;
        position: relative;
        overflow: hidden;
      }

      .page-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000" opacity="0.03"><path fill="%23FF6B8B" d="M500,200c150,0,250,100,250,250S650,700,500,700S250,600,250,450S350,200,500,200z"/></svg>');
        background-size: 600px;
        animation: float 20s infinite linear;
      }

      .page-header h1 {
        font-family: "Playfair Display", serif;
        font-size: 3.5rem;
        margin-bottom: 1rem;
        position: relative;
        z-index: 2;
      }

      .page-header p {
        font-size: 1.3rem;
        max-width: 600px;
        margin: 0 auto;
        opacity: 0.9;
        position: relative;
        z-index: 2;
      }

      .features {
        padding: 6rem 0;
        background: white;
      }

      .section-title {
        text-align: center;
        margin-bottom: 4rem;
      }

      .section-title h2 {
        font-family: "Playfair Display", serif;
        font-size: 3rem;
        color: var(--dark-text);
        margin-bottom: 1rem;
      }

      .section-title p {
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
        color: var(--dark-text);
        opacity: 0.8;
      }

      .form-container {
        background: white;
        padding: 3rem;
        border-radius: 25px;
        box-shadow: var(--shadow);
        border: 1px solid rgba(0, 0, 0, 0.03);
        position: relative;
        overflow: hidden;
        max-width: 800px;
        margin: 0 auto;
      }

      .form-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(
          135deg,
          var(--pastel-pink),
          var(--pastel-lilac)
        );
      }

      .form-group {
        margin-bottom: 1.8rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.8rem;
        font-weight: 600;
        color: var(--dark-text);
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 1.2rem;
        border: 2px solid #e9ecef;
        border-radius: 15px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f8f9fa;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--pastel-lilac);
        background: white;
        box-shadow: 0 0 0 3px rgba(216, 191, 216, 0.1);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }

      .success-message {
        display: none;
        background: linear-gradient(
          135deg,
          var(--pastel-pink),
          var(--pastel-lavender)
        );
        padding: 3rem;
        border-radius: 25px;
        text-align: center;
        box-shadow: var(--shadow);
        animation: fadeIn 0.5s ease;
        max-width: 800px;
        margin: 0 auto;
      }

      .success-message i {
        font-size: 4rem;
        color: var(--accent);
        margin-bottom: 1.5rem;
      }

      .success-message h2 {
        color: var(--dark-text);
        margin-bottom: 1rem;
        font-family: "Playfair Display", serif;
      }

      .success-message p {
        color: var(--dark-text);
        margin-bottom: 2rem;
        opacity: 0.9;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      footer {
        background: var(--dark-text);
        color: white;
        padding: 4rem 0 1.5rem;
      }

      .footer-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 3rem;
        margin-bottom: 3rem;
      }

      .footer-section h3 {
        margin-bottom: 1.5rem;
        color: var(--pastel-pink);
        font-size: 1.3rem;
      }

      .footer-section p {
        margin-bottom: 1rem;
        opacity: 0.8;
        line-height: 1.6;
      }

      .footer-links {
        list-style: none;
      }

      .footer-links li {
        margin-bottom: 0.8rem;
      }

      .footer-links a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .footer-links a:hover {
        color: var(--pastel-pink);
        transform: translateX(5px);
      }

      .social-links {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .social-links a {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        color: white;
        transition: all 0.3s ease;
      }

      .social-links a:hover {
        background: var(--accent);
        transform: translateY(-3px);
      }

      .footer-bottom {
        text-align: center;
        padding-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        opacity: 0.7;
      }

      @media (max-width: 768px) {
        .mobile-menu-btn {
          display: flex;
        }

        .logo {
          font-size: 1.6rem;
        }

        .nav-links {
          position: fixed;
          top: 80px;
          left: 0;
          width: 100%;
          background: white;
          flex-direction: column;
          padding: 2rem;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
          transform: translateY(-100%);
          opacity: 0;
          transition: all 0.3s ease;
          z-index: 999;
        }

        .nav-links.active {
          transform: translateY(0);
          opacity: 1;
        }

        .nav-links a {
          padding: 1rem;
          text-align: center;
          border-radius: 10px;
          margin-bottom: 0.5rem;
        }

        .auth-buttons {
          flex-direction: column;
          width: 100%;
          gap: 0.5rem;
        }

        .auth-buttons .btn {
          width: 100%;
          justify-content: center;
        }

        .page-header {
          padding: 120px 0 60px;
        }

        .page-header h1 {
          font-size: 2.5rem;
        }

        .page-header p {
          font-size: 1.1rem;
          padding: 0 10px;
        }

        .section-title h2 {
          font-size: 2.2rem;
        }

        .section-title p {
          font-size: 1rem;
          padding: 0 10px;
        }

        .features {
          padding: 4rem 0;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .form-container {
          padding: 2rem;
          margin: 0 10px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          font-size: 0.95rem;
        }

        .btn {
          padding: 0.7rem 1.5rem;
          font-size: 0.9rem;
        }

        .success-message {
          padding: 2rem;
          margin: 0 10px;
        }

        .success-message h2 {
          font-size: 1.8rem;
        }

        .footer-content {
          grid-template-columns: 1fr;
          gap: 2rem;
        }
      }

      @media (max-width: 480px) {
        .logo {
          font-size: 1.4rem;
        }

        .page-header {
          padding: 100px 0 50px;
        }

        .page-header h1 {
          font-size: 2rem;
        }

        .page-header p {
          font-size: 1rem;
        }

        .section-title h2 {
          font-size: 1.8rem;
        }

        .form-container {
          padding: 1.5rem;
        }

        .form-group label {
          font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          padding: 0.8rem;
          font-size: 0.9rem;
        }

        .btn {
          padding: 0.6rem 1.2rem;
          font-size: 0.85rem;
        }

        .success-message {
          padding: 1.5rem;
        }

        .success-message h2 {
          font-size: 1.5rem;
        }

        .success-message p {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <header id="header">
      <div class="container">
        <nav class="navbar">
          <div class="logo">
            <i class="fas fa-spa"></i>
            Raddison Salon
          </div>
          <button class="mobile-menu-btn" id="mobileMenuBtn">
            <span></span><span></span><span></span>
          </button>
          <ul class="nav-links" id="navLinks">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li><a href="services.html" class="nav-link">Services</a></li>
            <li>
              <a href="appointment.html" class="nav-link active"
                >Book Appointment</a
              >
            </li>
            <li><a href="about.html" class="nav-link">About Us</a></li>
            <li><a href="contact.html" class="nav-link">Contact</a></li>
            <li><a href="admin.html" class="nav-link">Admin</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <section class="page-header">
      <div class="container">
        <h1>Book Your Appointment</h1>
        <p>Schedule your beauty treatment with our expert stylists</p>
      </div>
    </section>

    <section class="features">
      <div class="container">
        <div class="form-container" id="appointmentForm">
          <h2
            style="
              text-align: center;
              margin-bottom: 2rem;
              color: var(--dark-text);
            "
          >
            Appointment Details
          </h2>
          <form id="bookingForm">
            <div class="form-group">
              <label for="fullName">Full Name *</label>
              <input
                type="text"
                id="fullName"
                name="fullName"
                required
                placeholder="Enter your full name"
              />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="email">Email Address *</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  placeholder="your@email.com"
                />
              </div>
              <div class="form-group">
                <label for="phone">Phone Number *</label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  required
                  placeholder="+1 234 567 8900"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="service">Select Service *</label>
              <select id="service" name="service" required>
                <option value="">Loading services...</option>
              </select>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="date">Preferred Date *</label>
                <input type="date" id="date" name="date" required />
              </div>
              <div class="form-group">
                <label for="time">Preferred Time (9:00 AM - 8:00 PM) *</label>
                <input
                  type="time"
                  id="time"
                  name="time"
                  required
                  min="09:00"
                  max="20:00"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="notes">Special Requests or Notes</label>
              <textarea
                id="notes"
                name="notes"
                rows="4"
                placeholder="Any special requirements or notes..."
              ></textarea>
            </div>
            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%; padding: 1.2rem; font-size: 1.1rem"
            >
              <i class="fas fa-calendar-check"></i> Confirm Appointment
            </button>
          </form>
        </div>

        <div class="success-message" id="successMessage">
          <i class="fas fa-check-circle"></i>
          <h2>Appointment Booked Successfully!</h2>
          <p>
            Thank you for choosing Raddison Salon. We've sent a confirmation to
            your email.
          </p>
          <a href="index.html" class="btn btn-primary"
            ><i class="fas fa-home"></i> Back to Home</a
          >
        </div>
      </div>
    </section>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>Raddison Salon</h3>
            <p>
              Your destination for premium beauty and wellness services.
              Experience luxury like never before.
            </p>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-pinterest"></i></a>
            </div>
          </div>
          <div class="footer-section">
            <h3>Quick Links</h3>
            <ul class="footer-links">
              <li>
                <a href="index.html"
                  ><i class="fas fa-chevron-right"></i> Home</a
                >
              </li>
              <li>
                <a href="services.html"
                  ><i class="fas fa-chevron-right"></i> Services</a
                >
              </li>
              <li>
                <a href="appointment.html"
                  ><i class="fas fa-chevron-right"></i> Book Appointment</a
                >
              </li>
              <li>
                <a href="about.html"
                  ><i class="fas fa-chevron-right"></i> About Us</a
                >
              </li>
              <li>
                <a href="contact.html"
                  ><i class="fas fa-chevron-right"></i> Contact</a
                >
              </li>
            </ul>
          </div>
          <div class="footer-section">
            <h3>Contact Info</h3>
            <p><i class="fas fa-map-marker-alt"></i> 123 Beauty Street, City</p>
            <p><i class="fas fa-phone"></i> +1 234 567 8900</p>
            <p><i class="fas fa-envelope"></i> info@raddisonsalon.com</p>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025 Raddison Salon. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const navLinks = document.getElementById("navLinks");

      if (mobileMenuBtn && navLinks) {
        mobileMenuBtn.addEventListener("click", function (e) {
          e.preventDefault();
          navLinks.classList.toggle("active");
          mobileMenuBtn.classList.toggle("active");
        });
      }

      function setActiveNavLink() {
        const current =
          window.location.pathname.split("/").pop() || "appointment.html";
        document
          .querySelectorAll(".nav-links a")
          .forEach((a) =>
            a.classList.toggle("active", a.getAttribute("href") === current)
          );
      }
      window.addEventListener("scroll", () =>
        document
          .getElementById("header")
          .classList.toggle("scrolled", window.scrollY > 50)
      );

      function toHHMMSS(t) {
        return t && /^\d{2}:\d{2}$/.test(t) ? `${t}:00` : t;
      }

      async function loadServices() {
        try {
          const response = await fetch("/api/all-services");
          const services = await response.json();

          const serviceSelect = document.getElementById("service");
          serviceSelect.innerHTML =
            '<option value="">Select a service</option>';

          const regularServices = services.filter((s) => !s.is_premium);
          const premiumServices = services.filter((s) => s.is_premium);

          if (regularServices.length > 0) {
            const regularGroup = document.createElement("optgroup");
            regularGroup.label = "Regular Services";
            regularServices.forEach((service) => {
              const option = document.createElement("option");
              option.value = service.service_id;
              option.textContent = `${service.service_name} (₹${service.price})`;
              regularGroup.appendChild(option);
            });
            serviceSelect.appendChild(regularGroup);
          }

          if (premiumServices.length > 0) {
            const premiumGroup = document.createElement("optgroup");
            premiumGroup.label = "Premium Services";
            premiumServices.forEach((service) => {
              const option = document.createElement("option");
              option.value = service.service_id;
              option.textContent = `${service.service_name} (₹${service.price})`;
              premiumGroup.appendChild(option);
            });
            serviceSelect.appendChild(premiumGroup);
          }
        } catch (error) {
          console.error("Error loading services:", error);
        }
      }

      async function loadStaff() {
        const staffSelect = document.getElementById("staff");
        if (!staffSelect) return;
        const date = document.getElementById("date")?.value;
        let time = toHHMMSS(document.getElementById("time")?.value);
        try {
          let url = "/api/staff";
          if (date && time)
            url = `/api/available-staff?date=${encodeURIComponent(
              date
            )}&time=${encodeURIComponent(time)}`;
          const r = await fetch(url);
          if (!r.ok) throw new Error("Failed to fetch staff");
          const payload = await r.json();
          const staff = Array.isArray(payload) ? payload : payload.staff;
          staffSelect.innerHTML =
            '<option value="">Any available staff</option>';
          (staff || []).forEach((m) => {
            const o = document.createElement("option");
            o.value = m.staff_id;
            o.textContent = `${m.full_name}${m.role ? " — " + m.role : ""}`;
            staffSelect.appendChild(o);
          });
        } catch (e) {
          console.error(e);
          staffSelect.innerHTML =
            '<option value="">Error loading staff</option>';
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const today = new Date().toISOString().split("T")[0];
        const dateInput = document.getElementById("date");
        if (dateInput) dateInput.min = today;
        setActiveNavLink();
        loadServices();
        loadStaff();
        document.getElementById("date")?.addEventListener("change", loadStaff);
        document.getElementById("time")?.addEventListener("change", loadStaff);

        const form = document.getElementById("bookingForm");
        form?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const btn = form.querySelector('button[type="submit"]');
          const original = btn.innerHTML;
          btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Booking...';
          btn.disabled = true;
          try {
            const fd = new FormData(form);
            const rawTime = fd.get("time");
            const hhmm = String(rawTime).slice(0, 5);
            if (hhmm < "09:00" || hhmm > "20:00")
              throw new Error("Please select a time between 09:00 and 20:00");
            const time = toHHMMSS(rawTime);

            const customer = {
              full_name: fd.get("fullName"),
              phone: fd.get("phone"),
              email: fd.get("email"),
            };
            const cr = await fetch("/api/customers", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(customer),
            });
            if (!cr.ok) throw new Error("Failed to create customer");
            const { customer_id } = await cr.json();

            const appt = {
              customer_id,
              staff_id: null,
              service_id: fd.get("service"),
              appointment_date: fd.get("date"),
              appointment_time: time,
              notes: fd.get("notes") || null,
            };
            const ar = await fetch("/api/appointments", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(appt),
            });
            if (!ar.ok) {
              const t = await ar.text();
              throw new Error(t || "Failed to create appointment");
            }

            document.getElementById("appointmentForm").style.display = "none";
            document.getElementById("successMessage").style.display = "block";
          } catch (err) {
            console.error("Booking error:", err);
            alert(
              "Sorry, there was an error booking your appointment. " +
                (err.message || "Please try again.")
            );
          } finally {
            btn.innerHTML = original;
            btn.disabled = false;
          }
        });
      });

      document.addEventListener("click", (e) => {
        if (
          !e.target.closest(".navbar") &&
          navLinks.classList.contains("active")
        )
          navLinks.classList.remove("active");
      });
    </script>
  </body>
</html>
